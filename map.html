<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dispatch Distance Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1.5rem;
      background: #0b0c10;
      color: #f5f5f5;
    }

    h1 {
      margin-bottom: 0.5rem;
    }

    .subtitle {
      margin-bottom: 1.5rem;
      color: #c7c7c7;
      font-size: 0.95rem;
    }

    .layout {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
    }

    .card {
      background: #151821;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      flex: 1 1 380px;
      min-width: 360px;
    }

    form {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    input[type="text"] {
      flex: 1 1 260px;
      padding: 0.6rem 0.8rem;
      border-radius: 0.5rem;
      border: 1px solid #333;
      background: #0e1017;
      color: #f5f5f5;
    }

    input[type="text"]::placeholder {
      color: #777;
    }

    button {
      padding: 0.6rem 1.1rem;
      border-radius: 0.5rem;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: #2c82ff;
      color: white;
      transition: 0.1s;
      white-space: nowrap;
    }

    .status {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      min-height: 1.2em;
    }

    /* View Toggle Buttons */
    .view-toggle {
      display: inline-flex;
      border-radius: 999px;
      background: #11131b;
      padding: 0.18rem;
      margin: 1rem 0 1.25rem;
    }

    .view-toggle button {
      background: transparent;
      border-radius: 999px;
      padding: 0.45rem 0.9rem;
      font-size: 0.85rem;
      font-weight: 600;
      border: none;
    }

    .view-toggle button.active {
      background: #2c82ff;
    }

    #map-view {
      display: none;
    }

    #map {
      width: 100%;
      height: 420px;
      border-radius: 0.75rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }

    th, td {
      padding: 0.55rem 0.4rem;
      text-align: left;
    }

    th {
      border-bottom: 1px solid #333;
      color: #d7d7d7;
      font-weight: 600;
      font-size: 0.8rem;
      text-transform: uppercase;
    }

    tr.highlight td {
      background: rgba(44,130,255,0.12);
    }

    .small {
      font-size: 0.8rem;
      color: #aaa;
    }
  </style>
</head>

<body>
  <h1>Unit Distance Checker</h1>
  <div class="subtitle">
    Enter a call address to see driving distance & ETA from both Transport Trucks and QRV Paramedics.
  </div>

  <!-- INPUT CARD -->
  <div class="card">
    <form id="address-form">
      <input id="address-input" type="text" placeholder="5531 Airport Rd. Anderson, SC 29625" />
      <button type="submit">Check Distances</button>
    </form>

    <div id="status" class="status"></div>

    <!-- VIEW SWITCH -->
    <div class="view-toggle">
      <button id="btn-list" class="active">List View</button>
      <button id="btn-map">Map View</button>
    </div>
  </div>

  <!-- LIST VIEW -->
  <div class="layout" id="list-view">

    <div class="card">
      <h2>Transport Trucks</h2>
      <table id="results-transport" style="display:none;">
        <thead><tr><th>Unit</th><th>Post</th><th>Distance</th><th>ETA</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h2>QRV - Paramedics</h2>
      <table id="results-qrv" style="display:none;">
        <thead><tr><th>Unit</th><th>Post</th><th>Distance</th><th>ETA</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

  <!-- MAP VIEW -->
  <div class="card" id="map-view">
    <h2>Map View</h2>
    <p class="small">Call location + all units with clickable markers.</p>
    <div id="map"></div>
  </div>


<script>
/* --------------------- UNIT LISTS --------------------- */

const TRANSPORT_UNITS = [
  { name: "Med-0", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-1", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-2", address: "135 HWY 413, Belton SC 29627" },
  { name: "Med-3", address: "3228 S Main St, Anderson, SC 29624" },
  { name: "Med-4", address: "902 Anderson Dr. Williamston SC 29697" },
  { name: "Med-5", address: "2850 Concord Rd Anderson SC, 29621" },
  { name: "Med-6", address: "9711 SC-81, Iva, SC 29655" },
  { name: "Med-7", address: "108 N Depot St, Pendleton, SC 29670" },
  { name: "Med-8", address: "8508 SC-24, Townville, SC 29689" },
  { name: "Med-9", address: "103 Construction Way. Anderson, SC 29625" },
  { name: "Med-10", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-11", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-12", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-13", address: "6 Gaines Rd, Honea Path, SC 29654" },
  { name: "Med-14", address: "10600 Anderson Rd, Easley, SC 29642" },
  { name: "Med-15", address: "2209 SC-86, Piedmont, SC 29673" },
  { name: "Med-16", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-17", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-18", address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "Med-19", address: "1009 N Fant St. Anderson, SC 29625" },
];

const QRV_UNITS = [
  { name: "A-5",  address: "103 Construction Way. Anderson, SC 29625" },
  { name: "A-8",  address: "1009 N Fant St. Anderson, SC 29625" },
  { name: "ALS-2", address: "5321 US-76, Pendleton, SC 29670" },
  { name: "ALS-3", address: "3228 S Main St, Anderson, SC 29624" },
  { name: "ALS-4", address: "7715 SC-81, Starr, SC 29684" },
  { name: "ALS-6", address: "101 Main St, Pelzer, SC 29669" },
  { name: "ALS-7", address: "10600 Anderson Rd, Easley, SC 29642" },
  { name: "ALS-11", address: "5125 Dobbins Bridge Rd, Anderson, SC 29626" },
  { name: "ALS-12", address: "1 Holmes St, Belton SC, 29627" },
  { name: "ALS-17", address: "316 Hattons Ford Rd, Townville, SC 29689" },
  { name: "ALS-19", address: "1058 Martin Rd, Anderson, SC 29621" },
  { name: "ALS-21", address: "1118 Trail Rd, Honea Path, SC 29654" },
  { name: "ALS-23", address: "1416 Due West Hwy, Anderson, SC 29621" },
  { name: "ALS-24", address: "2209 SC-86, Piedmont, SC 29673" },
  { name: "ALS-27", address: "3738 SC-187, Anderson, SC 29626" },
];


/* --------------------- GOOGLE SERVICES --------------------- */

let geocoder;
let distanceMatrix;

let map;
let markers = [];
let lastDestination = null;
let transportResults = [];
let qrvResults = [];


/* Init Google Services */
function initMapsServices() {
  geocoder = new google.maps.Geocoder();
  distanceMatrix = new google.maps.DistanceMatrixService();
}


/* --------------------- VIEW TOGGLE --------------------- */

const btnList = document.getElementById("btn-list");
const btnMap = document.getElementById("btn-map");
const listView = document.getElementById("list-view");
const mapView = document.getElementById("map-view");

btnList.onclick = () => {
  btnList.classList.add("active");
  btnMap.classList.remove("active");
  listView.style.display = "flex";
  mapView.style.display = "none";
};

btnMap.onclick = () => {
  btnMap.classList.add("active");
  btnList.classList.remove("active");
  listView.style.display = "none";
  mapView.style.display = "block";

  setTimeout(() => initOrUpdateMap(), 50);
};


/* --------------------- ADDRESS SEARCH --------------------- */

document.getElementById("address-form").addEventListener("submit", e => {
  e.preventDefault();
  const address = document.getElementById("address-input").value.trim();
  const status = document.getElementById("status");

  if (!address) {
    status.textContent = "Please enter a valid address.";
    return;
  }

  status.textContent = "Finding address...";

  geocoder.geocode({ address }, (results, statusCode) => {
    if (statusCode !== "OK") {
      status.textContent = "Address not found.";
      return;
    }

    lastDestination = results[0].geometry.location;

    transportResults = [];
    qrvResults = [];

    calculateGroup(TRANSPORT_UNITS, "results-transport", transportResults);
    calculateGroup(QRV_UNITS, "results-qrv", qrvResults);
  });
});


/* --------------------- DISTANCE CALCULATIONS --------------------- */

function calculateGroup(units, tableId, storeArray) {
  distanceMatrix.getDistanceMatrix({
    origins: units.map(u => u.address),
    destinations: [lastDestination],
    travelMode: google.maps.TravelMode.DRIVING,
    unitSystem: google.maps.UnitSystem.IMPERIAL
  }, (res, stat) => {

    if (stat !== "OK") return;

    const rows = res.rows;
    const results = [];

    for (let i = 0; i < rows.length; i++) {
      const el = rows[i].elements[0];

      results.push({
        unit: units[i],
        distanceText: el.status === "OK" ? el.distance.text : "N/A",
        durationText: el.status === "OK" ? el.duration.text : "N/A",
        distanceValue: el.status === "OK" ? el.distance.value : Infinity
      });
    }

    results.sort((a, b) => a.distanceValue - b.distanceValue);

    storeArray.length = 0;
    storeArray.push(...results);

    renderTable(results, tableId);
  });
}


/* --------------------- RENDER LIST TABLE --------------------- */

function renderTable(results, tableId) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector("tbody");

  tbody.innerHTML = "";
  results.forEach((r, i) => {
    const row = document.createElement("tr");
    if (i === 0) row.classList.add("highlight");

    row.innerHTML = `
      <td>${r.unit.name}</td>
      <td>${r.unit.address}</td>
      <td>${r.distanceText}</td>
      <td>${r.durationText}</td>
    `;

    tbody.appendChild(row);
  });

  table.style.display = "table";
}


/* --------------------- MAP + MARKERS --------------------- */

function clearMarkers() {
  markers.forEach(m => m.setMap(null));
  markers = [];
}

function initOrUpdateMap() {
  if (!lastDestination) return;

  const mapDiv = document.getElementById("map");

  map = new google.maps.Map(mapDiv, {
    center: lastDestination,
    zoom: 11,
    mapTypeControl: false,
    streetViewControl: false
  });

  clearMarkers();
  const bounds = new google.maps.LatLngBounds();

  /* Add Call Location Marker */
  const callMarker = new google.maps.Marker({
    position: lastDestination,
    map,
    title: "Call Location",
    icon: {
      path: google.maps.SymbolPath.CIRCLE,
      scale: 8,
      fillColor: "#ff4444",
      fillOpacity: 1,
      strokeColor: "#fff",
      strokeWeight: 1,
    }
  });

  markers.push(callMarker);
  bounds.extend(lastDestination);

  /* Add all unit markers */
  addUnitMarkers(transportResults, "#2c82ff");  // blue
  addUnitMarkers(qrvResults, "#00d68f");       // green

  map.fitBounds(bounds);

  function addUnitMarkers(results, color) {
    results.forEach(r => {
      geocoder.geocode({ address: r.unit.address }, (res, status) => {
        if (status !== "OK") return;
        const loc = res[0].geometry.location;

        const marker = new google.maps.Marker({
          position: loc,
          map,
          title: `${r.unit.name}`,
          icon: {
            path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
            scale: 5,
            fillColor: color,
            fillOpacity: 1,
            strokeColor: "#000",
            strokeWeight: 1
          }
        });

        const info = new google.maps.InfoWindow({
          content: `
            <div style="font-size:14px;">
              <strong>${r.unit.name}</strong><br>
              ${r.unit.address}<br>
              <hr>
              Distance: ${r.distanceText}<br>
              ETA: ${r.durationText}
            </div>
          `
        });

        marker.addListener("click", () => info.open(map, marker));

        markers.push(marker);
        bounds.extend(loc);
        map.fitBounds(bounds);
      });
    });
  }
}
</script>

<script
  async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBD6nSsnOuLe5-BBep0DnfkxaXkPrTtYCM&callback=initMapsServices">
</script>

</body>
</html>
