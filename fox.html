<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M3U8 Player (iPad-friendly)</title>
  <style>
    :root { color-scheme: light dark; }
    body { margin: 0; min-height: 100svh; display: grid; place-items: center; background:#0b0c10; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .wrap { width:min(100%, 960px); padding:16px; }
    .card { background:#111418; border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    h1 { margin:0 0 12px; color:#e8eaed; font-weight:600; }
    .player { position:relative; aspect-ratio:16/9; width:100%; background:#000; border-radius:12px; overflow:hidden; }
    video { width:100%; height:100%; display:block; background:#000; }
    .msg { margin-top:10px; color:#cbd5e1; font-size:.95rem; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>M3U8 Player</h1>
      <div class="player">
        <!-- Native controls include pause, volume, fullscreen -->
        <video id="video"
               controls
               playsinline
               webkit-playsinline
               preload="metadata">
          Your browser doesn’t support HTML5 video.
        </video>
      </div>
      <div id="status" class="msg hidden"></div>
    </div>
  </div>

  <!-- hls.js for non-Safari browsers; not used on iOS/iPadOS -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    (function () {
      const src = "https://dai2-playlistserver.aws.syncbak.com/media.m3u8?bitrate=3659760&session=1c375518aea64b6c998758e3da4e996e";
      const video = document.getElementById("video");
      const statusEl = document.getElementById("status");

      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent)
        || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1); // iPadOS on Safari identifies as Mac

      function showStatus(msg) {
        statusEl.textContent = msg;
        statusEl.classList.remove("hidden");
      }

      // 1) iOS/iPadOS Safari: set src directly (best compatibility)
      if (isIOS) {
        video.src = src;
        video.addEventListener("error", () => {
          showStatus("Playback error on iPad/iPhone. If this persists, the stream may block cross-origin playback or need HTTPS/CORS adjustments.");
        });
        return;
      }

      // 2) Desktop Safari/macOS with native HLS:
      if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = src;
        video.addEventListener("error", () => {
          showStatus("Playback error (native HLS). Check the stream URL and server headers.");
        });
        return;
      }

      // 3) Other browsers: use hls.js (MSE)
      if (window.Hls && Hls.isSupported()) {
        // Only set crossorigin when using MSE/hls.js
        video.setAttribute("crossorigin", "anonymous");

        const hls = new Hls({
          enableWorker: true,
          lowLatencyMode: true,
          backBufferLength: 90
        });
        hls.loadSource(src);
        hls.attachMedia(video);

        hls.on(Hls.Events.ERROR, (evt, data) => {
          if (!data) return;
          if (data.fatal) {
            switch (data.type) {
              case Hls.ErrorTypes.NETWORK_ERROR:
                showStatus("Network error. Retrying…");
                hls.startLoad();
                break;
              case Hls.ErrorTypes.MEDIA_ERROR:
                showStatus("Media error. Attempting recovery…");
                hls.recoverMediaError();
                break;
              default:
                showStatus("Fatal error. Reloading player…");
                hls.destroy();
                setTimeout(() => {
                  const n = new Hls({ enableWorker: true, lowLatencyMode: true, backBufferLength: 90 });
                  n.loadSource(src);
                  n.attachMedia(video);
                }, 250);
            }
          }
        });

        video.addEventListener("error", () => {
          showStatus("Playback error (MSE). If this persists, check the stream URL and CORS settings.");
        });
      } else {
        showStatus("Your browser doesn’t support HLS playback. Try Chrome, Edge, Firefox, or Safari.");
      }
    })();
  </script>
</body>
</html>
