<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Live TV Channels</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0; min-height: 100svh; background: #0b0c10;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      display: grid; place-items: center;
    }
    .wrap { width: min(100%, 960px); padding: 16px; transition: padding .2s ease; }
    .card {
      background:#111418; border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      transition: border-radius .2s ease, padding .2s ease, box-shadow .2s ease;
    }
    .chrome h1 { margin:0 0 10px; color:#e8eaed; font-weight:600; }
    .channels { display:flex; gap:8px; flex-wrap:wrap; margin: 0 0 12px; }
    .chan {
      appearance:none; border:1px solid rgba(255,255,255,.25);
      background:#1f2937; color:#fff; border-radius:10px; cursor:pointer;
      padding:8px 12px; font:600 13px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    .chan.active { background:#334155; }
    .player { position:relative; width:100%; aspect-ratio:16/9; background:#000; border-radius:12px; overflow:hidden; }
    video { width:100%; height:100%; display:block; background:#000; }

    .chanLabel {
      position:absolute; left:12px; top:12px; z-index:10000;
      padding:6px 10px; border-radius:999px;
      background:rgba(0,0,0,.55); color:#fff;
      font:600 13px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      backdrop-filter: blur(6px);
      user-select:none;
    }
    .chanLabel[contenteditable="true"] {
      outline: 2px solid rgba(255,255,255,.45);
      background: rgba(0,0,0,.75);
      cursor:text;
    }

    .toolbar {
      position:absolute; right:8px; bottom:8px; display:flex; gap:8px;
      padding:6px; border-radius:10px; background: rgba(0,0,0,.35); backdrop-filter: blur(6px);
    }
    .btn {
      appearance: none; border:1px solid rgba(255,255,255,.25);
      background: rgba(31,41,55,.85); color:#fff; border-radius:10px;
      font:600 13px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      padding:8px 10px; cursor:pointer;
    }
    .note { margin-top:10px; color:#cbd5e1; font-size:.95rem; }

    body.stage2 .wrap { padding: 0; }
    body.stage2 .card { padding:0; border:none; border-radius:0; box-shadow:none; }
    body.stage2 .chrome, body.stage2 .channels, body.stage2 .note { display:none; }
    body.stage2 .player { border-radius:0; }

    body.stage3 { display:block; }
    body.stage3 .wrap, body.stage3 .card { padding:0; border:none; border-radius:0; box-shadow:none; }
    body.stage3 .chrome, body.stage3 .channels, body.stage3 .note { display:none; }
    body.stage3 .player { position:fixed; inset:0; z-index:9999; border-radius:0; }

    @supports not (aspect-ratio: 1/1) {
      .player::before { content:""; float:left; padding-top:56.25%; }
      .player::after { content:""; display:block; clear:both; }
      video { position:absolute; inset:0; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="chrome">
        <h1>Live TV</h1>
        <div class="channels" id="channelsBar">
          <button class="chan active" id="CNN Live"
            data-url="https://turnerlive.warnermediacdn.com/hls/live/586495/cnngo/cnn_slate/VIDEO_0_3564000.m3u8"
            data-name="CNN Live">CNN Live</button>
          <button class="chan" id="NBC News Now"
            data-url="https://livetv-fa.tubi.video/nbc-news-now/master.m3u8"
            data-name="NBC News Now">NBC News Now</button>
          <button class="chan" id="ABC News"
            data-url="https://content.uplynk.com/channel/3324f2467c414329b3b0cc5cd987b6be.m3u8"
            data-name="ABC News">ABC News</button>
          <button class="chan" id="Disney Junior"
            data-url="https://tvpass.org/live/DisneyChannelEast/hd"
            data-name="Disney Junior">Disney Junior</button>
          <button class="chan" id="Disney Channel"
            data-url="https://tvpass.org/live/DisneyJuniorEast/hd"
            data-name="Disney Channel">Disney Channel</button>
          <button class="chan" id="FX"
            data-url="https://tvpass.org/live/FX/hd"
            data-name="FX">FX</button>
          <button class="chan" id="FXX"
            data-url="https://tvpass.org/live/FXX/hd"
            data-name="FXX">FXX</button>
          <button class="chan" id="USA Network"
            data-url="https://tvpass.org/live/USANetworkEast/hd"
            data-name="USA Network">USA Network</button>
        </div>
      </div>

      <div class="player" id="playerBox">
        <div class="chanLabel" id="chanLabel" title="Double-click to rename"></div>

        <video id="video"
               controls
               playsinline
               webkit-playsinline
               preload="metadata"
               controlsList="nodownload">
        </video>

        <div class="toolbar">
          <button class="btn" id="editNameBtn" title="Rename current channel">✏️ Name</button>
          <button class="btn" id="cycleBtn" title="Normal → Clean → Maximized → Fullscreen">⤢ Full Page</button>
        </div>
      </div>

      <p class="note" id="status">Keys: 1–9/0 switch channels (0 = #10). Double-click the name to edit. F cycles stages.</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    (function () {
      const video = document.getElementById("video");
      const statusEl = document.getElementById("status");
      const cycleBtn = document.getElementById("cycleBtn");
      const editNameBtn = document.getElementById("editNameBtn");
      const playerBox = document.getElementById("playerBox");
      const chanLabel = document.getElementById("chanLabel");
      const chanBtns = Array.from(document.querySelectorAll(".chan"));

      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent)
        || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);

      const channels = chanBtns.map((btn, idx) => ({
        index: idx + 1,
        button: btn,
        get url(){ return btn.dataset.url; },
        set url(v){ btn.dataset.url = v; },
        get name(){ return btn.dataset.name || btn.textContent.trim() || ("Channel " + (idx+1)); },
        set name(v){ btn.dataset.name = v; btn.textContent = v; }
      }));

      let hls = null;
      let currentIndex = 1;
      let stage = 1;

      function destroyHls() { if (hls) { try { hls.destroy(); } catch {} hls = null; } }
      function useNative() { return (isIOS || video.canPlayType("application/vnd.apple.mpegurl")); }

      function attachNative(url) { destroyHls(); video.removeAttribute("crossorigin"); video.src = url; video.load(); }
      function attachHlsJs(url) {
        destroyHls();
        if (!(window.Hls && Hls.isSupported())) return false;
        video.setAttribute("crossorigin", "anonymous");
        hls = new Hls({ enableWorker:true, lowLatencyMode:true, backBufferLength:90 });
        hls.loadSource(url);
        hls.attachMedia(video);
        return true;
      }

      async function loadChannelByIndex(idx, autoPlay = true) {
        const ch = channels[idx - 1];
        if (!ch) return;
        currentIndex = idx;

        chanBtns.forEach(b => b.classList.remove("active"));
        ch.button.classList.add("active");

        chanLabel.textContent = ch.name;

        video.pause();
        video.removeAttribute("src");
        video.load();

        if (useNative()) attachNative(ch.url);
        else attachHlsJs(ch.url);

        if (autoPlay) { try { await video.play(); } catch {} }
      }

      chanBtns.forEach((btn, i) => btn.addEventListener("click", () => loadChannelByIndex(i+1, true)));

      document.addEventListener("keydown", (e) => {
        if (["INPUT","TEXTAREA"].includes(document.activeElement.tagName)) return;
        const k = e.key;
        if (k >= "1" && k <= "9") loadChannelByIndex(parseInt(k, 10), true);
        if (k === "0") loadChannelByIndex(10, true);
        if (k.toLowerCase() === "f") { e.preventDefault(); cycleBtn.click(); }
      });

      function startInlineEdit() {
        chanLabel.setAttribute("contenteditable","true");
        const sel = window.getSelection(), range = document.createRange();
        range.selectNodeContents(chanLabel); range.collapse(false);
        sel.removeAllRanges(); sel.addRange(range);
        chanLabel.focus();
      }
      function finishInlineEdit(save = true) {
        if (!chanLabel.isContentEditable) return;
        chanLabel.removeAttribute("contenteditable");
        if (!save) { chanLabel.textContent = channels[currentIndex-1].name; return; }
        const newName = chanLabel.textContent.trim();
        if (newName) channels[currentIndex-1].name = newName;
        else chanLabel.textContent = channels[currentIndex-1].name;
      }

      editNameBtn.addEventListener("click", () => {
        if (!chanLabel.isContentEditable) startInlineEdit(); else finishInlineEdit(true);
      });
      chanLabel.addEventListener("dblclick", () => startInlineEdit());
      chanLabel.addEventListener("keydown", (e) => {
        if (e.key === "Enter") { e.preventDefault(); finishInlineEdit(true); }
        if (e.key === "Escape") { e.preventDefault(); finishInlineEdit(false); }
      });
      chanLabel.addEventListener("blur", () => finishInlineEdit(true));

      function applyStage(next) {
        stage = next;
        document.body.classList.remove("stage2", "stage3");
        if (stage === 1) { if (document.fullscreenElement) document.exitFullscreen?.(); }
        else if (stage === 2) document.body.classList.add("stage2");
        else if (stage === 3) document.body.classList.add("stage3");
        else if (stage === 4) {
          if (isIOS && typeof video.webkitEnterFullscreen === "function") video.webkitEnterFullscreen();
          else playerBox.requestFullscreen?.().catch(()=>applyStage(3));
        }
      }
      function nextStage() { applyStage(stage === 4 ? 1 : stage + 1); }

      cycleBtn.addEventListener("click", () => { nextStage(); if (video.paused) video.play().catch(()=>{}); });

      ["fullscreenchange","webkitfullscreenchange"].forEach(ev =>
        document.addEventListener(ev, () => { if (!document.fullscreenElement && stage === 4) applyStage(1); })
      );
      video.addEventListener("webkitendfullscreen", () => { if (stage === 4) applyStage(1); });

      loadChannelByIndex(1, false);
    })();
  </script>
  <!-- Network status bar -->
<style>
  #netBar{
    position:fixed;
    bottom:0; left:0; right:0;
    height:26px;
    background:#111; color:#eee;
    font:12px/26px monospace;
    display:flex;
    align-items:center;
    justify-content:space-around;
    z-index:9999;
    border-top:1px solid #333;
  }
  #netBar span{padding:0 8px;}
  #netBar small{color:#888;margin-left:3px}
</style>
<div id="netBar">
  <span id="ip">--</span>
  <span id="dl">↓ <span>--</span> Mbps</span>
  <span id="ping">ping <span>--</span> ms</span>
  <span id="net">--</span>
</div>
<script>
(()=>{
  const $=id=>document.getElementById(id);
  const bar=$('netBar');
  if (!navigator.connection){ bar.style.display='none'; return; }

  async function update(){
    // IP
    try{
      const r=await fetch('https://api.ipify.org?format=json');
      const j=await r.json();
      $('ip').textContent=j.ip;
    }catch{ $('ip').textContent='--'; }

    // Downlink + network
    const c=navigator.connection;
    $('dl').querySelector('span').textContent=(c.downlink||0).toFixed(1);
    $('net').textContent=c.effectiveType?.toUpperCase()||'--';

    // Ping (tiny 1×1 gif)
    const t=performance.now();
    fetch('https://www.google.com/favicon.ico?t='+Date.now(),{mode:'no-cors'})
      .finally(()=>{
        $('ping').querySelector('span').textContent=(performance.now()-t).toFixed(0);
      });
  }
  update();
  setInterval(update,10000);
})();
</script>
</body>
</html>
