<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Bar</title>
  <style>
    body{margin:0;height:100vh;background:#111;color:#fff;font-family:monospace}
    #net-bar{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;padding:6px;background:rgba(0,0,0,.8)}
    #net-bar span{color:#0ff}
  </style>
</head>
<body>
   <!-- ========== BOTTOM BAR ========== -->
  <footer id="net-bar">
    <div>IP: <span id="nb-ip">…</span></div>
    <div>Location: <span id="nb-loc">…</span></div>
    <div>ASN: <span id="nb-asn">…</span></div>
    <div>Download: <span id="nb-dl">…</span> Mbps</div>
    <div>Jitter: <span id="nb-jit">…</span> ms</div>
    <div>Ping: <span id="nb-ping">…</span> ms</div>
    <div>Network: <span id="nb-net">…</span></div>
  </footer>

  <style>
  #net-bar{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;align-items:center;padding:6px 4px;background:rgba(0,0,0,.65);color:#fff;font:12px/1 monospace;flex-wrap:wrap;gap:4px;z-index:9998}
  #net-bar div{white-space:nowrap}
  #net-bar span{color:#0ff}
  </style>

  <script>
  document.addEventListener('DOMContentLoaded',()=>{
    const $=id=>document.getElementById(id);
    async function geo(){
      try{
        const ipRes=await fetch('https://api.ipify.org?format=json');
        const {ip}=await ipRes.json();
        const info=await(await fetch(`https://ipinfo.io/${ip}/json`)).json();
        $('#nb-ip').textContent=ip;
        $('#nb-loc').textContent=info.city&&info.region?`${info.city}, ${info.region}`:'--';
        $('#nb-asn').textContent=info.org?info.org.split(' ')[0]:'--';
      }catch{
        $('#nb-ip').textContent=$('#nb-loc').textContent=$('#nb-asn').textContent='--';
      }
    }
    async function speedTest(){
      $('#nb-dl').textContent=$('#nb-jit').textContent=$('#nb-ping').textContent='…';
      try{
        const downSize=10000000;
        const t0=performance.now();
        await fetch(`https://speed.cloudflare.com/__down?bytes=${downSize}&t=${Date.now()}`,{mode:'cors'});
        const downMs=performance.now()-t0;
        const mbps=((downSize*8)/1e6)/(downMs/1000);
        $('#nb-dl').textContent=mbps.toFixed(0);

        const pings=await Promise.all([1,2,3].map(()=>fetch('https://speed.cloudflare.com/__down?bytes=0&t='+Date.now()).then(()=>performance.now()).then(t=>t-performance.now())));
        const avg=pings.reduce((a,b)=>a+b)/3;
        const jit=Math.sqrt(pings.map(p=>Math.pow(p-avg,2)).reduce((a,b)=>a+b)/3);
        $('#nb-jit').textContent=jit.toFixed(0);
        $('#nb-ping').textContent=avg.toFixed(0);
      }catch{
        $('#nb-dl').textContent=$('#nb-jit').textContent=$('#nb-ping').textContent='--';
      }
    }
    function networkName(){
      const c=navigator.connection||navigator.mozConnection||navigator.webkitConnection;
      if(!c)return '--';
      if(c.type==='wifi'&&c.SSID)return c.SSID;
      return c.effectiveType?c.effectiveType.toUpperCase():'--';
    }
    $('#nb-net').textContent=networkName();
    geo(); speedTest();
    setInterval(()=>{geo(); speedTest();},15000);
  });
  </script>
</body>
</html>
