<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Shift Report</title>

<style>
:root{
  --bg-dark:#05070d;
  --bg-mid:#0b1020;
  --panel:#141a2e;
  --field:#1b2140;
  --border:rgba(255,255,255,.22);
  --text:#f1f3ff;
  --accent:#4f8cff;
}

*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
  background: linear-gradient(180deg, var(--bg-dark), var(--bg-mid));
  min-height:100vh;
}

.hero{
  position:fixed;
  inset:0;
  z-index:-1;
  background:
    radial-gradient(1200px 800px at 20% 30%, rgba(80,140,255,.25), transparent 60%),
    radial-gradient(1000px 700px at 80% 60%, rgba(255,80,120,.25), transparent 60%),
    linear-gradient(180deg, #05070d 0%, #0b1020 100%);
}

.wrap{
  max-width:1200px;
  margin:auto;
  padding:24px 18px 80px;
}

form{
  background: rgba(20,26,46,.92);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px;
  box-shadow:0 25px 50px rgba(0,0,0,.65);
}

.section{
  margin-bottom:16px;
  padding:14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
}

.section-title{
  font-weight:900;
  font-size:14px;
  letter-spacing:.4px;
  margin-bottom:12px;
}

.grid{
  display:grid;
  grid-template-columns: repeat(4,1fr);
  gap:16px;
}

.grid-2{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:16px;
}

@media(max-width:1000px){
  .grid{ grid-template-columns: repeat(2,1fr); }
  .grid-2{ grid-template-columns:1fr; }
}
@media(max-width:600px){
  .grid{ grid-template-columns:1fr; }
}

.field{
  display:flex;
  flex-direction:column;
  gap:6px;
}

label{
  font-weight:700;
  font-size:14px;
}

input, textarea, select{
  background: var(--field);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px 12px;
  color:var(--text);
  font-size:14px;
}

textarea{
  resize:vertical;
}

.bigbox{ min-height:220px; }
.issues{ min-height:260px; font-family: ui-monospace, Menlo, Consolas, monospace; }

.footer{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:18px;
}

.btn{
  background:var(--accent);
  border:none;
  color:white;
  font-weight:900;
  padding:14px 24px;
  border-radius:14px;
  cursor:pointer;
}

.btn-ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,.25);
  color:var(--text);
  font-weight:900;
  padding:14px 20px;
  border-radius:14px;
  cursor:pointer;
}

.small-note{
  opacity:.8;
  font-size:12px;
}

.toast{
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%);
  background: rgba(20,26,46,.96);
  border: 1px solid rgba(255,255,255,.18);
  padding: 10px 14px;
  border-radius: 12px;
  display:none;
}
</style>
</head>

<body>
<div class="hero"></div>

<div class="wrap">
<form id="shiftForm">

  <div class="section">
    <div class="section-title">Shift Info</div>
    <div class="grid">
      <div class="field">
        <label>Name</label>
        <input name="name">
      </div>
      <div class="field">
        <label>Date</label>
        <input type="date" name="date">
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Time & Exceptions</div>
    <div class="grid-2">
      <div class="field">
        <label>Late Trucks</label>
        <textarea name="lateTrucks" class="bigbox"></textarea>
      </div>
      <div class="field">
        <label>Out of Chute Times</label>
        <textarea name="outOfChute" class="bigbox"></textarea>
      </div>
    </div>
    <div class="field">
      <label>Issues / Other Notes</label>
      <textarea name="issues" class="issues"></textarea>
    </div>
  </div>

  <div class="footer">
    <div id="saveStatus" class="small-note">Not saved yet</div>
    <button type="button" class="btn-ghost" onclick="clearSavedData()">Clear Saved Data</button>
    <button type="button" class="btn" onclick="sendEmail()">Send Email</button>
  </div>

</form>
</div>

<div class="toast" id="toast"></div>

<script>
const STORAGE_KEY = "shiftReportDraft_v1";
const SEND_TO_EMAILS = "test@example.com";
let saveTimer = null;

function showToast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.display = "block";
  setTimeout(()=>t.style.display="none", 3000);
}

function updateSaveStatus(d){
  const el = document.getElementById("saveStatus");
  const time = d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
  el.textContent = "Locally auto saved at " + time;
}

function saveDraft(){
  const form = document.getElementById("shiftForm");
  const data = Object.fromEntries(new FormData(form).entries());
  localStorage.setItem(STORAGE_KEY, JSON.stringify({
    savedAt: new Date().toISOString(),
    data
  }));
  updateSaveStatus(new Date());
}

function scheduleSave(){
  clearTimeout(saveTimer);
  saveTimer = setTimeout(saveDraft, 200);
}

function restoreDraft(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  const payload = JSON.parse(raw);
  for(const k in payload.data){
    const el = document.querySelector(`[name="${k}"]`);
    if(el) el.value = payload.data[k];
  }
  if(payload.savedAt){
    updateSaveStatus(new Date(payload.savedAt));
  }
}

function clearSavedData(){
  if(!confirm("Clear saved data?")) return;
  localStorage.removeItem(STORAGE_KEY);
  document.getElementById("shiftForm").reset();
  document.getElementById("saveStatus").textContent = "Not saved yet";
}

function buildEmailBody(d){
  var DIV = "==============================";
  var indent = "    ";

  function rtrim(s){
    s = s == null ? "" : String(s);
    return s.replace(/\s+$/g,"");
  }

  function indentBlock(text){
    var t = rtrim(text);
    if(!t) return "";
    return indent + t.replace(/\r?\n/g, "\r\n" + indent);
  }

  var lines = [
    DIV,
    "TIME & EXCEPTIONS",
    DIV,
    "Late Trucks:",
    indentBlock(d.lateTrucks),
    "",
    "Out of Chute Times:",
    indentBlock(d.outOfChute),
    "",
    "Issues / Other Notes:",
    indentBlock(d.issues)
  ];

  return lines.join("\r\n");
}

function sendEmail(){
  const d = Object.fromEntries(new FormData(document.getElementById("shiftForm")).entries());
  const body = buildEmailBody(d);
  window.location.href =
    "mailto:" + encodeURIComponent(SEND_TO_EMAILS) +
    "?subject=" + encodeURIComponent("Shift Report") +
    "&body=" + encodeURIComponent(body);
}

document.getElementById("shiftForm").addEventListener("input", scheduleSave);
document.getElementById("shiftForm").addEventListener("change", scheduleSave);

restoreDraft();
</script>

</body>
</html>
